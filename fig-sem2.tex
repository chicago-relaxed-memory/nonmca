\begin{figure}
  \bookmark{Semantics of programs}
  \raggedright
  \noindent
  If $\aPS\in\sSKIP$ then $\aEvs = \emptyset$ and
  $\aTr{\bEvs}{\bForm} \riff \bForm$.
  \medskip

  \noindent
  If $\aPS \in \sLPAR{\aPSS_1}{\aPSS_2}$ then  
  $(\exists\aPS_1\in\aPSS_1)$ $(\exists\aPS_2\in\aPSS_2)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{p}\arabic*),ref=\textsc{p}\arabic*]
    \item \label{par-E}
      $\aEvs = (\aEvs_1\uplus\aEvs_2)$,
    \item \label{par-lambda}
      ${\labeling}=\PBR{{\labeling_1}\cup {\labeling_2}}$, 
    \item[] \setcounter{enumi}{\value{kappa}} \labeltextX{3}{p}{par-kappa}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{par-kappa1} if $\aEv\in\aEvs_1$ then $\labelingForm(\aEv) \riff \labelingForm_1(\aEv)$,
      \item \label{par-kappa2} if $\aEv\in\aEvs_2$ then $\labelingForm(\aEv) \riff \labelingForm_2(\aEv)$,
      \end{enumerate}
    \item \label{par-tau}
      $\aTr{\bEvs}{\bForm} \riff \aTr[1]{\bEvs}{\bForm}$,
    \item \label{par-term}
      $\aTerm \riff \aTerm[1]\land\aTerm[2]$,
    \item \label{par-ledep}
      ${\ledep}\supseteq\PBR{{\ledep_1}\cup{\ledep_2}}$, 
    \item \label{par-lesync}
      ${\lesync}\supseteq\PBR{{\lesync_1}\cup{\lesync_2}}$, 
    \item \label{par-leloc}
      ${\leloc}\supseteq\PBR{{\leloc_1}\cup{\leloc_2}}$, 
    \item \label{par-rmw}
      ${\rrmw}=\PBR{{\rrmw_1}\cup{\rrmw_2}}$.
    \end{enumerate}    
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sSEMI{\aPSS_1}{\aPSS_2}$ then
  $(\exists\aPS_1\in\aPSS_1)$ $(\exists\aPS_2\in\aPSS_2)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{s}\arabic*),ref=\textsc{s}\arabic*]
    \item \label{seq-E}
      $\aEvs = (\aEvs_1\cup\aEvs_2)$,
    \item \label{seq-lambda}
      \labeltextXX{6}{s}{seq-ledep}
      \labeltextXX{7}{s}{seq-lesync}
      \labeltextXX{8}{s}{seq-leloc}
      \labeltextXX{9}{s}{seq-rmw} as for $\sLPAR{}{}$,
    \item[] \setcounter{enumi}{\value{kappa}} \labeltextX{3}{s}{seq-kappa}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{seq-kappa1}
        if $\aEv\in\aEvs_1\setminus\aEvs_2$ then $\labelingForm(\aEv) \riff \labelingForm_1(\aEv)$,
      \item \label{seq-kappa2}
        if $\aEv\in\aEvs_2\setminus\aEvs_1$ then $\labelingForm(\aEv) \riff \labelingForm'_2(\aEv)$,%\land \aTerm[1](\aEv)$,
      \item \label{seq-kappa12}
        if $\aEv\in\aEvs_1\cap\aEvs_2$ then $\labelingForm(\aEv) \riff \labelingForm_1(\aEv)\lor\labelingForm'_2(\aEv)$,%\land \aTerm[1](\aEv)$,
      % \item \label{seq-release}
      %   if $\labeling_2(\aEv)$ is a $\srelease$ then $\labelingForm(\aEv) \riff \aTerm[1]$,
      \end{enumerate}
    \item \label{seq-tau}
      $\aTr{\bEvs}{\bForm} \riff \aTr[1]{\bEvs}{\aTr[2]{\bEvs}{\bForm}}$,
    \item \label{seq-term}
      $\aTerm \riff \aTerm[1]\land\aTr[1]{}{\aTerm[2]}$,
    \item[] \setcounter{enumi}{\value{lesync}}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{seq-delay-sync}
        if $\labeling_1(\bEv)\rsyncdelays\labeling_2(\aEv)$
        %and $\labelingForm_1(\bEv) \land \labelingForm_2(\aEv)$ is satisfiable
        then $\bEv\lesync\aEv$,
      \end{enumerate}
    \item[] \setcounter{enumi}{\value{leloc}}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{seq-delay-co}
        if $\labeling_1(\bEv)\rcodelays\labeling_2(\aEv)$
        %and $\labelingForm_1(\bEv) \land \labelingForm_2(\aEv)$ is satisfiable
        then $\bEv\leloc\aEv$.
      \end{enumerate}
    \end{enumerate}
  \end{multicols}
  where
  $\labelingForm'_2(\aEv)=\aTr[1]{}{\labelingForm_2(\aEv})$ if $\labeling(\aEv)$ is a $\sread$---otherwise
  $\labelingForm'_2(\aEv)=\aTr[1]{\Cdown{\aEv}}{\labelingForm_2(\aEv})$, where
  $\Cdown{\aEv}=\{ \cEv \mid \cEv \ltdep \aEv \}$;
  % \\
  % where
  % $\aTerm[1](\aEv) = \aTerm[1]$ if $\labeling(\aEv)$ is a $\srelease$---otherwise
  % $\aTerm[1](\aEv) = \TRUE$.
  \medskip

  \noindent
  If $\aPS \in \sIFTHEN{\aForm}{\aPSS_1}{\aPSS_2}$ then
  $(\exists\aPS_1\in\aPSS_1)$ $(\exists\aPS_2\in\aPSS_2)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{i}\arabic*),ref=\textsc{i}\arabic*]
    \item \label{if-E}
      $\aEvs = (\aEvs_1\cup\aEvs_2)$,
    \item \label{if-lambda}
      \labeltextXX{6}{i}{if-ledep}
      \labeltextXX{7}{i}{if-lesync}
      \labeltextXX{8}{i}{if-leloc}
      \labeltextXX{9}{i}{if-rmw} as for $\sLPAR{}{}$,
    \item[] \setcounter{enumi}{\value{kappa}} \labeltextX{4}{i}{if-kappa}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{if-kappa1}
        if $\aEv\in\aEvs_1\setminus\aEvs_2$ then $\labelingForm(\aEv) \riff \aForm\land\labelingForm_1(\aEv)$,
      \item \label{if-kappa2}
        if $\aEv\in\aEvs_2\setminus\aEvs_1$ then $\labelingForm(\aEv) \riff \neg\aForm\land\labelingForm_2(\aEv)$, 
      \item \label{if-kappa12}
        if $\aEv\in\aEvs_1\cap\aEvs_2$\\ then
        $\labelingForm(\aEv) \riff (\aForm\land\labelingForm_1(\aEv))\lor(\neg\aForm\land\labelingForm_2(\aEv))$,
      \end{enumerate}
    \item \label{if-tau}
      $\aTr{\bEvs}{\bForm} \riff (\aForm\land\aTr[1]{\bEvs}{\bForm})\lor(\neg\aForm\land\aTr[2]{\bEvs}{\bForm})$,
    \item \label{if-term}
      $\aTerm \riff (\aForm\land\aTerm[1])\lor(\neg\aForm\land\aTerm[2])$.
    \end{enumerate}
  \end{multicols}
  \medskip

  % \noindent
  % If $\aPS \in \sIFTHEN{\aForm}{\aPSS_1}{}$ then
  % $(\exists\aPS_1\in\aPSS_1)$ %$(\exists\aPS_2\in\sSKIP)$
  % \begin{multicols}{2}
  %   \begin{enumerate}[topsep=0pt,label=(\textsc{it}\arabic*),ref=\textsc{it}\arabic*]
  %   \item \label{if-then-E}
  %     \labeltextXX{2}{it}{if-then-lambda}
  %     \labeltextXX{6}{it}{if-then-ledep}
  %     \labeltextXX{7}{it}{if-then-lesync}
  %     \labeltextXX{8}{it}{if-then-leloc}
  %     \labeltextXX{9}{it}{if-then-rmw} from $\aPS_1$
  %   \setcounter{enumi}{\value{Bkappa}}
  %   \item \label{if-then-kappa}
  %     $\labelingForm(\aEv) \riff \aForm\land\labelingForm_1(\aEv)$,
  %   \item \label{if-then-tau}
  %     $\aTr{\bEvs}{\bForm} \riff (\aForm\land\aTr[1]{\bEvs}{\bForm})\lor(\neg\aForm\land\bForm)$,
  %   \item \label{if-then-term}
  %     $\aTerm \riff (\aForm\land\aTerm[1])\lor\neg\aForm$.
  %   \end{enumerate}
  % \end{multicols}
  % \medskip

  \noindent
  If $\aPS\in\sLET{\aReg}{\aExp}$ then $\aEvs = \emptyset$ and
  $\aTr{\bEvs}{\bForm} \riff \bForm[\aExp/\aReg]$.
  \medskip

  \noindent
  If $\aPS \in \sSTORE[\amode]{\aLoc}[\ascope]{\aExp}[\aThrd]$ then
  $(\exists\aVal\in\Val)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{w}\arabic*),ref=\textsc{w}\arabic*]
    \item \label{write-E}
      $\fcard{\aEvs}\leq1$,
      %if $\bEv,\aEv\in\aEvs$ then $\bEv=\aEv$,
    \item \label{write-lambda}
      $\labelingAct(\aEv) = \DW[\amode]{\aLoc}[\ascope]{\aVal}[\aThrd]$,
    \item \label{write-kappa}
      \begin{math}
        \labelingForm(\aEv) \riff
        \aExp{=}\aVal
      \end{math},    
    \item \label{write-tau}
      \begin{math}
        \aTr{\bEvs}{\bForm} \riff 
        \bForm[\aExp/\aLoc]
      \end{math},
    \item[] \setcounter{enumi}{\value{term}} \labeltextX{5}{w}{write-term}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{write-term-nonempty}
        if $\aEvs\neq\emptyset$ then $\aTerm \riff \aExp{=}\aVal$.
      \item \label{write-term-empty}
        if $\aEvs=\emptyset$ then $\aTerm \riff \FALSE$,
      \end{enumerate}
    \end{enumerate}
  \end{multicols}
  \medskip
  
  \noindent
  If $\aPS \in \sLOAD[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]$ then
  $(\exists\aVal\in\Val)$
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{r}\arabic*),ref=\textsc{r}\arabic*]
    \item \label{read-E}
      $\fcard{\aEvs}\leq1$,
      %if $\bEv,\aEv\in\aEvs$ then $\bEv=\aEv$,
    \item \label{read-lambda}
      $\labelingAct(\aEv) = \DR[\amode]{\aLoc}[\ascope]{\aVal}[\aThrd]$,      
    \item \label{read-kappa}
      $\labelingForm(\aEv) \riff \Q{\aLoc}$,
    \item[] \setcounter{enumi}{\value{tau}} \labeltextX{4}{r}{read-tau}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{read-tau-dep}
        if $\aEv\in\aEvs$ and $\aEv\in\bEvs$ then
        % if $\aEvs=\{\aEv\}$ %$\aEvs\neq\emptyset$
        % and $(\aEvs\cap\bEvs)\neq\emptyset$ then
        \begin{math}
          \aTr{\bEvs}{\bForm} \riff
          \aVal{=}\uReg{\aEv}
          \limplies \bForm[\uReg{\aEv}/\aReg]
        \end{math},    
      \item \label{read-tau-ind}
        if $\aEv\in\aEvs$ and $\aEv\notin\bEvs$ then
        % if $\aEvs=\{\aEv\}$ %$\aEvs\neq\emptyset$
        % and $(\aEvs\cap\bEvs)=\emptyset$ then
        \begin{math}
          \aTr{\bEvs}{\bForm} \riff
          \PBR{\aVal{=}\uReg{\aEv} \lor \aLoc{=}\uReg{\aEv}} \limplies
          \bForm[\uReg{\aEv}/\aReg],
        \end{math}
      \item \label{read-tau-empty}
        if $\aEvs=\emptyset$ then
        \begin{math}
          (\forall\bReg)
          \aTr{\bEvs}{\bForm} \riff
          \bForm[\bReg/\aReg],
        \end{math}
      \end{enumerate}
      \stepcounter{enumi}
    \item[] \labeltext[\textsc{r}5]{}{read-term}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{read-term-nonempty}
        if $\aEvs\neq\emptyset$ or $\amode\lemode\mRLX$ then $\aTerm \riff \TRUE$. 
      \item \label{read-term-empty}
        if $\aEvs=\emptyset$ and $\amode\gemode\mACQ$ then $\aTerm \riff \FALSE$. 
      \end{enumerate}      
    % \item \label{read-term}
    %   if $\aEvs=\emptyset$ and $\amode\gemode\mACQ$ then $\aTerm \riff \FALSE$. 
    \end{enumerate}
  \end{multicols}
  \medskip

  \noindent
  If $\aPS \in \sFENCE[\ascope]{\amode}[\aThrd]$ then
  \begin{multicols}{2}
    \begin{enumerate}[topsep=0pt,label=(\textsc{f}\arabic*),ref=\textsc{f}\arabic*]
    \item \label{fence-E}
      $\fcard{\aEvs}\leq1$,
      %if $\bEv,\aEv\in\aEvs$ then $\bEv=\aEv$,
    \item \label{fence-lambda}
      $\labelingAct(\aEv) = \DF[\ascope]{\amode}[\aThrd]$,
    \item \label{fence-kappa}
      $\labelingForm(\aEv) \riff \TRUE$,
      %\setcounter{enumi}{\value{Btau}}
    \item \label{fence-tau}
      $\aTr{\bEvs}{\bForm} \riff \bForm$,
      \stepcounter{enumi}      
    \item[] \labeltext[\textsc{f}5]{}{fence-term}
      \begin{enumerate}[leftmargin=0pt]
      \item \label{fence-term-nonempty}
        if $\aEvs\neq\emptyset$ then $\aTerm \riff \TRUE$,
      \item \label{fence-term-empty}
        if $\aEvs=\emptyset$ then $\aTerm \riff \FALSE$.
      \end{enumerate}
    % \item \label{fence-term}
    %   if $\aEvs=\emptyset$ then $\aTerm \riff \FALSE$.
    \end{enumerate}
  \end{multicols}

  \begin{align*}
    \begin{aligned}
      \sem[\aThrd]{\LET{\aReg}{\aExp}} &= \sLET{\aReg}{\aExp}
      \\
      \sem[\aThrd]{\PR[\amode]{\aLoc}{\aReg}} &= \sLOAD[\amode]{\aReg}[\ascope]{\aLoc}[\aThrd]
      \\
      \sem[\aThrd]{\PW[\amode]{\aLoc}{\aExp}} &= \sSTORE[\amode]{\aLoc}[\ascope]{\aExp}[\aThrd]
      \\
      \sem[\aThrd]{\PF[\ascope]{\fmode}} &= \sFENCE[\ascope]{\fmode}[\aThrd]
    \end{aligned}
    &&
    \begin{aligned}
      \sem[\aThrd]{\SKIP} &= \sSKIP 
      \\
      \sem[\aThrd]{\aCmd_1 \LPAR[\bThrd] \aCmd_2} &= \sLPAR{\sem[\aThrd]{\aCmd_1}}{\sem[\bThrd]{\aCmd_2}}
      \\
      \sem[\aThrd]{\aCmd_1 \SEMI \aCmd_2} &= \sSEMI{\sem[\aThrd]{\aCmd_1}}{\sem[\aThrd]{\aCmd_2}}
      \\
      \sem[\aThrd]{\IF{\aExp}\THEN\aCmd_1\ELSE\aCmd_2\FI} &= \sIFTHEN{\aExp{\neq}0}{\sem[\aThrd]{\aCmd_1}}{\sem[\aThrd]{\aCmd_2}}
    \end{aligned}
  \end{align*}
  \caption{Semantics of programs}
  \label{fig:sem}
\end{figure}
